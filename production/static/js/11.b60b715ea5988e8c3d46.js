webpackJsonp([11],{EVc5:function(e,t){},et2I:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("bGai"),a=s("0xDb"),o=s("lbHh"),r=s.n(o),n={data:function(){return{data:[{name:"全部",subNav:Object(a.d)()}],defaultProps:{children:"subNav",label:"name"},checkedKeys:[],checkedNames:[],roleData:[],defaultProps1:{children:"children",label:"label"},isAdd:!1,isEdit:!1,roleForm:{roleName:""},roleRules:{roleName:{required:!0,message:"角色名不能为空",trigger:"blur"}},loading:!1,liActive:{},oldRoleName:""}},components:{listHandle:i.c},methods:{append:function(){var e=this;this.isEdit?this.$message.error("有角色信息未保存"):(this.isAdd=!0,this.roleForm.roleName="",this.$nextTick(function(){e.liActive={},e.roleData.map(function(e){e.isActive=!1}),e.$refs.roleName.focus()}))},checked:function(e,t){var s=this;this.checkedNames=[],t.checkedNodes.map(function(e){e.subNav||("string"==typeof e.auth?s.checkedNames.push({name:e.auth}):s.checkedNames.push({name:e.auth()}))})},save:function(e,t){var s=this;""!==e?this.$refs.roleForm[t].validate(function(i){i&&s.save_post(e,s.roleForm.roleName,t,"roleForm","")}):this.$refs.addRoleForm.validate(function(i){i&&s.save_post(e,s.roleForm.roleName,t,"addRoleForm","")})},save_post:function(e,t,s,i,o){var r=this;e=""===e?null:e,""!==t?this.isAdd||this.isEdit&&""!==this.oldRoleName&&this.oldRoleName!==t?this.$fly.post(a.a.roleIsExist,{name:t}).then(function(a){if(1e5===a.status){if(a.data)return r.$message({message:"保存失败，角色名已存在",type:"error"}),!1;r.roleSavePost(e,t,s,i,o)}else r.$message({message:"查询失败",type:"error"})}):this.roleSavePost(e,t,s,i,o):this.$message({message:"角色名不能为空",duration:2e3,type:"error"})},roleSavePost:function(e,t,s,i,o){var n=this,l=r.a.getJSON("user").rolesName;this.$fly.post(a.a.roleSave,{id:null===e?null:e.id,name:t,authorities:this.checkedNames}).then(function(t){1e5===t.status?(n.$message({message:"保存成功",type:"success"}),n.$refs.tree.setCheckedKeys([]),n.getRoles(),"saveAll"===o?(n.liActive.name===l&&n.signOut("您修改了当前用户所属角色的权限，请重新登录"),e.isEdit=!1,n.isEdit=!1):"roleForm"===i?(e.isEdit=!1,n.isEdit=!1,n.$refs[""+i][s].resetFields(),e.name===l&&n.signOut("您修改了当前用户所属的角色，请重新登录")):(n.isAdd=!1,n.$refs[""+i].resetFields())):n.$message({message:"保存失败",type:"error"})}).catch(function(){n.$message({message:"请求失败",duration:2e3,type:"error"})})},saveAll:function(){if("超级管理员"!==this.liActive.name)if(this.isAdd)this.$message.error("有角色信息未保存");else if(this.lodash.isUndefined(this.liActive.name))this.$message({message:"请先选择角色",duration:2e3,type:"error"});else{var e=void 0;e=""===this.roleForm.roleName?this.liActive.name:this.roleForm.roleName,this.save_post(this.liActive,e,"","","saveAll")}else this.$message({message:"无法修改超级管理员的权限",duration:2e3,type:"info"})},cancel:function(e,t){""!==e?(e.isEdit=!1,this.isEdit=!1,this.$refs.roleForm[t].resetFields()):(this.isAdd=!1,this.$refs.addRoleForm.resetFields())},edit:function(e,t){if(this.isAdd)this.$message.error("有角色信息未保存");else{e.isEdit=!0,this.isEdit=!0;for(var s=this.roleData,i=0;i<s.length;i++)s[i].id!==e.id&&(s[i].isEdit=!1);this.roleForm.roleName=e.name,this.liActive=e,this.oldRoleName=e.name,this.roleClick(e)}},remove:function(e){var t=this;Object(a.b)("您确定删除角色' "+e.name+" '吗？","提示").then(function(){var s=[];s.push(e.id),t.$fly.post(a.a.roleDelete,s).then(function(s){1e5===s.status?(t.$message({showClose:!0,type:"success",message:"删除成功"}),t.$refs.tree.setCheckedKeys([]),e.name===r.a.getJSON("user").rolesName?t.signOut("您删除了当前用户所属的角色，请重新登录"):t.getRoles()):t.$message({showClose:!0,type:"error",message:"删除失败"})}).catch(function(){t.$message({message:"请求失败",duration:2e3,type:"error"})})})},signOut:function(e){var t=this;this.$message({message:""+e,type:"warning"}),setTimeout(function(){r.a.remove("user"),t.$router.replace({name:"login"})},500)},roleClick:function(e){if(!e.isActive){for(var t=this.roleData,s=0;s<t.length;s++)t[s].id!==e.id?t[s].isActive=!1:(e.isActive=!0,this.liActive=e);this.liActiveId=e.id,this.$refs.tree.setCheckedKeys([]),this.getAuth(e)}},getAuth:function(e){var t=this;this.loading=!0;var s=[];this.$fly.get(a.a.roleGetOne,{id:e.id}).then(function(e){setTimeout(function(){t.loading=!1},1e3);var i=[],a=[];e.data.authorities.map(function(e){s.push(e.name)}),s.map(function(e){t.hasAuth(e)&&t.data[0].subNav.map(function(t){t.subNav.map(function(t){t.subNav?t.subNav.map(function(t){e===t.auth&&(i.push(t.id),a.push({name:t.auth}))}):e===t.auth()&&(i.push(t.id),a.push({name:t.auth()}))})})}),t.$set(t,"checkedKeys",i),t.checkedNames=a}).catch(function(){t.$message({message:"删除失败",duration:2e3,type:"error"})})},getRoles:function(){var e=this;this.$fly.get(a.a.getRoles).then(function(t){t.data.RoleList.map(function(e){e.isEdit=!1,e.isActive=!1}),e.roleData=t.data.RoleList}).catch(function(){e.$message({message:"请求失败",duration:2e3,type:"error"})})}},created:function(){this.getRoles()}},l={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"page"},[s("div",{staticClass:"tools-bar btn-wrap"},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return t.stopPropagation(),e.append(t)}}},[e._v("新增")]),e._v(" "),s("el-button",{attrs:{type:"warning",size:"small"},on:{click:function(t){return t.stopPropagation(),e.saveAll(t)}}},[e._v("保存")])],1),e._v(" "),s("div",{staticClass:"body"},[s("div",{staticClass:"left-wrap"},[s("ul",{staticClass:"role"},e._l(e.roleData,function(t,i){return s("li",{key:i,class:{liActive:t.isActive}},[s("div",{directives:[{name:"show",rawName:"v-show",value:!t.isEdit,expression:"!item.isEdit"}],on:{click:function(s){s.stopPropagation(),s.preventDefault(),e.roleClick(t)}}},[s("label",[e._v(e._s(t.name))]),e._v(" "),"超级管理员"!==t.name?s("label",[s("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit"},on:{click:function(s){s.stopPropagation(),s.preventDefault(),e.edit(t,i)}}},[e._v("\n                编辑\n              ")]),e._v(" "),s("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(s){s.stopPropagation(),s.preventDefault(),e.remove(t)}}},[e._v("\n                删除\n              ")])],1):e._e()]),e._v(" "),s("el-form",{directives:[{name:"show",rawName:"v-show",value:t.isEdit,expression:"item.isEdit"}],ref:"roleForm",refInFor:!0,staticClass:"add-role",attrs:{model:e.roleForm,rules:e.roleRules}},[s("el-form-item",{attrs:{prop:"roleName"}},[s("el-input",{ref:"editRoleName",refInFor:!0,staticClass:"role-name",attrs:{placeholder:"请输入角色名",autofocus:""},model:{value:e.roleForm.roleName,callback:function(t){e.$set(e.roleForm,"roleName",t)},expression:"roleForm.roleName"}}),e._v(" "),s("label",{staticClass:"btn-wrap"},[s("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(s){s.stopPropagation(),s.preventDefault(),e.save(t,i)}}},[e._v("保存")]),e._v(" "),s("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(s){s.stopPropagation(),s.preventDefault(),e.cancel(t,i)}}},[e._v("取消")])],1)],1)],1)],1)})),e._v(" "),e.isAdd?s("el-form",{ref:"addRoleForm",staticClass:"add-role",attrs:{model:e.roleForm,rules:e.roleRules}},[s("el-form-item",{attrs:{prop:"roleName"}},[s("el-input",{ref:"roleName",staticClass:"role-name",attrs:{placeholder:"请输入角色名",autofocus:""},model:{value:e.roleForm.roleName,callback:function(t){e.$set(e.roleForm,"roleName",t)},expression:"roleForm.roleName"}}),e._v(" "),s("label",{staticClass:"btn-wrap"},[s("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){t.stopPropagation(),e.save("")}}},[e._v("保存")]),e._v(" "),s("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){t.stopPropagation(),e.cancel("")}}},[e._v("取消")])],1)],1)],1):e._e()],1),e._v(" "),s("div",{staticClass:"right-wrap"},[s("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tree",attrs:{data:e.data,"show-checkbox":"","default-expand-all":"","default-checked-keys":e.checkedKeys,"node-key":"id",props:e.defaultProps},on:{check:e.checked}})],1)])])},staticRenderFns:[]};var c=s("VU/8")(n,l,!1,function(e){s("EVc5")},"data-v-275200f4",null);t.default=c.exports}});
//# sourceMappingURL=11.b60b715ea5988e8c3d46.js.map