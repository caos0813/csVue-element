{"version":3,"sources":["webpack:///src/pages/system/authority.vue","webpack:///./src/pages/system/authority.vue?5590","webpack:///./src/pages/system/authority.vue"],"names":["system_authority","data","name","subNav","Object","utils","defaultProps","children","label","checkedKeys","checkedNames","roleData","defaultProps1","isAdd","isEdit","roleForm","roleName","roleRules","required","message","trigger","loading","liActive","oldRoleName","components","listHandle","methods","append","_this","this","$message","error","$nextTick","map","item","isActive","$refs","focus","checked","e","_this2","checkedNodes","auth","push","save","index","_this3","validate","valid","save_post","ref","type","_this4","$fly","post","roleIsExist","then","status","roleSavePost","duration","_this5","rolesName","js_cookie_default","a","getJSON","roleSave","id","authorities","tree","setCheckedKeys","getRoles","signOut","resetFields","catch","saveAll","lodash","isUndefined","cancel","edit","i","length","roleClick","remove","_this6","checkIds","roleDelete","showClose","txt","_this7","setTimeout","$router","replace","liActiveId","getAuth","_this8","authority","get","roleGetOne","checkedData","checkedNameData","hasAuth","dItem","sItem","tItem","$set","_this9","RoleList","created","pages_system_authority","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","size","on","click","$event","stopPropagation","_v","_l","key","class","directives","rawName","value","expression","preventDefault","_s","icon","_e","refInFor","model","rules","prop","placeholder","autofocus","callback","$$v","show-checkbox","default-expand-all","default-checked-keys","node-key","props","check","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/3.7389de6a49c96bf638b4.js","sourcesContent":["<template>\r\n  <div class=\"page\">\r\n    <div class=\"tools-bar btn-wrap\">\r\n      <el-button type=\"primary\" size=\"small\" @click.stop=\"append\">新增</el-button>\r\n      <el-button type=\"warning\" size=\"small\" @click.stop=\"saveAll\">保存</el-button>\r\n    </div>\r\n    <div class=\"body\">\r\n      <div class=\"left-wrap\">\r\n        <ul class=\"role\">\r\n          <li v-for=\"(item,index) in roleData\" :key=\"index\" :class=\"{'liActive':item.isActive}\">\r\n            <div v-show=\"!item.isEdit\" @click.stop.prevent=\"roleClick(item)\">\r\n              <label>{{ item.name }}</label>\r\n              <label v-if=\"item.name!=='管理员'\">\r\n                <el-button type=\"text\" size=\"mini\" icon=\"el-icon-edit\" @click.stop.prevent=\"edit(item,index)\">\r\n                  编辑\r\n                </el-button>\r\n                <el-button type=\"text\" size=\"mini\" icon=\"el-icon-delete\" @click.stop.prevent=\"remove(item)\">\r\n                  删除\r\n                </el-button>\r\n              </label>\r\n            </div>\r\n            <el-form :model=\"roleForm\" ref=\"roleForm\" :rules=\"roleRules\" v-show=\"item.isEdit\" class=\"add-role\">\r\n              <el-form-item prop=\"roleName\">\r\n                <el-input v-model=\"roleForm.roleName\" placeholder=\"请输入角色名\" autofocus class=\"role-name\" ref=\"editRoleName\"></el-input>\r\n                <label class=\"btn-wrap\">\r\n                  <el-button type=\"text\" size=\"mini\" @click.stop.prevent=\"save(item,index)\">保存</el-button>\r\n                  <el-button type=\"text\" size=\"mini\" @click.stop.prevent=\"cancel(item,index)\">取消</el-button>\r\n                </label>\r\n              </el-form-item>\r\n            </el-form>\r\n          </li>\r\n        </ul>\r\n        <el-form :model=\"roleForm\" ref=\"addRoleForm\" :rules=\"roleRules\" v-if=\"isAdd\" class=\"add-role\">\r\n          <el-form-item prop=\"roleName\">\r\n            <el-input v-model=\"roleForm.roleName\" ref=\"roleName\" placeholder=\"请输入角色名\" autofocus class=\"role-name\"></el-input>\r\n            <label class=\"btn-wrap\">\r\n              <el-button type=\"text\" size=\"mini\" @click.stop=\"save('')\">保存</el-button>\r\n              <el-button type=\"text\" size=\"mini\" @click.stop=\"cancel('')\">取消</el-button>\r\n            </label>\r\n          </el-form-item>\r\n        </el-form>\r\n      </div>\r\n      <div class=\"right-wrap\">\r\n        <el-tree :data=\"data\" ref=\"tree\" show-checkbox default-expand-all :default-checked-keys=\"checkedKeys\" node-key=\"id\" :props=\"defaultProps\" v-loading=\"loading\" @check=\"checked\"></el-tree>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { listHandle } from '@/components'\r\nimport { api, getNavJson, confirm } from '@/utils'\r\nimport Cookies from 'js-cookie'\r\nexport default {\r\n  data () {\r\n    return {\r\n      data: [{\r\n        name: '全部',\r\n        subNav: getNavJson()\r\n      }],\r\n      defaultProps: {\r\n        children: 'subNav',\r\n        label: 'name'\r\n      },\r\n      checkedKeys: [],\r\n      checkedNames: [],\r\n      roleData: [],\r\n      defaultProps1: {\r\n        children: 'children',\r\n        label: 'label'\r\n      },\r\n      isAdd: false,\r\n      isEdit: false,\r\n      roleForm: {\r\n        roleName: ''\r\n      },\r\n      roleRules: {\r\n        roleName: { required: true, message: '角色名不能为空', trigger: 'blur' }\r\n      },\r\n      loading: false,\r\n      liActive: {},\r\n      oldRoleName: ''\r\n    }\r\n  },\r\n  components: {\r\n    listHandle\r\n  },\r\n  methods: {\r\n    // 新增\r\n    append () {\r\n      if (this.isEdit) {\r\n        this.$message.error('有角色信息未保存')\r\n      } else {\r\n        this.isAdd = true\r\n        this.roleForm.roleName = ''\r\n        this.$nextTick(() => {\r\n          this.liActive = {}\r\n          this.roleData.map(item => {\r\n            item.isActive = false\r\n          })\r\n          this.$refs.roleName.focus()\r\n        })\r\n      }\r\n    },\r\n    checked (e, data) {\r\n      this.checkedNames = []\r\n      // this.checkedKeys = []\r\n      data.checkedNodes.map(item => {\r\n        if (!item.subNav) {\r\n          if (typeof item.auth === 'string') {\r\n            this.checkedNames.push({ name: item.auth })\r\n          } else {\r\n            this.checkedNames.push({ name: item.auth() })\r\n          }\r\n        }\r\n      })\r\n    },\r\n    // 保存角色\r\n    save (item, index) {\r\n      if (item !== '') {\r\n        this.$refs['roleForm'][index].validate((valid) => {\r\n          if (valid) {\r\n            this.save_post(item, this.roleForm.roleName, index, 'roleForm', '')\r\n          }\r\n        })\r\n      } else {\r\n        this.$refs['addRoleForm'].validate((valid) => {\r\n          if (valid) {\r\n            this.save_post(item, this.roleForm.roleName, index, 'addRoleForm', '')\r\n          }\r\n        })\r\n      }\r\n    },\r\n    save_post (item, name, index, ref, type) {\r\n      item = item === '' ? null : item\r\n      if (name !== '') {\r\n        if (this.isAdd || (this.isEdit && this.oldRoleName !== '' && this.oldRoleName !== name)) {\r\n          this.$fly.post(api.roleIsExist, { name: name }).then(data => {\r\n            if (data.status === 100000) {\r\n              if (data.data) {\r\n                this.$message({\r\n                  message: '保存失败，角色名已存在',\r\n                  type: 'error'\r\n                })\r\n                return false\r\n              } else {\r\n                this.roleSavePost(item, name, index, ref, type)\r\n              }\r\n            } else {\r\n              this.$message({\r\n                message: '查询失败',\r\n                type: 'error'\r\n              })\r\n            }\r\n          })\r\n        } else {\r\n          this.roleSavePost(item, name, index, ref, type)\r\n        }\r\n      } else {\r\n        this.$message({\r\n          message: '角色名不能为空',\r\n          duration: 2000,\r\n          type: 'error'\r\n        })\r\n      }\r\n    },\r\n    roleSavePost (item, name, index, ref, type) {\r\n      let rolesName = Cookies.getJSON('user').rolesName\r\n      this.$fly.post(api.roleSave, {\r\n        id: item === null ? null : item.id,\r\n        name: name,\r\n        authorities: this.checkedNames\r\n      }).then(data => {\r\n        if (data.status === 100000) {\r\n          this.$message({\r\n            message: '保存成功',\r\n            type: 'success'\r\n          })\r\n          this.$refs.tree.setCheckedKeys([])\r\n          this.getRoles()\r\n          if (type === 'saveAll') {\r\n            if (this.liActive.name === rolesName) {\r\n              this.signOut('您修改了当前用户所属角色的权限，请重新登录')\r\n            }\r\n            // this.getAuth(this.liActive)\r\n            item.isEdit = false\r\n            this.isEdit = false\r\n          } else {\r\n            if (ref === 'roleForm') {\r\n              item.isEdit = false\r\n              this.isEdit = false\r\n              this.$refs[`${ref}`][index].resetFields()\r\n              if (item.name === rolesName) {\r\n                this.signOut('您修改了当前用户所属的角色，请重新登录')\r\n              }\r\n            } else {\r\n              this.isAdd = false\r\n              this.$refs[`${ref}`].resetFields()\r\n            }\r\n          }\r\n        } else {\r\n          this.$message({\r\n            message: '保存失败',\r\n            type: 'error'\r\n          })\r\n        }\r\n      }).catch(() => {\r\n        this.$message({\r\n          message: '请求失败',\r\n          duration: 2000,\r\n          type: 'error'\r\n        })\r\n      })\r\n    },\r\n    // 保存所有\r\n    saveAll () {\r\n      if (this.liActive.name !== '管理员') {\r\n        if (this.isAdd) {\r\n          this.$message.error('有角色信息未保存')\r\n        } else {\r\n          if (!this.lodash.isUndefined(this.liActive.name)) {\r\n            let name\r\n            if (this.roleForm.roleName === '') {\r\n              name = this.liActive.name\r\n            } else {\r\n              name = this.roleForm.roleName\r\n            }\r\n            this.save_post(this.liActive, name, '', '', 'saveAll')\r\n          } else {\r\n            this.$message({\r\n              message: '请先选择角色',\r\n              duration: 2000,\r\n              type: 'error'\r\n            })\r\n          }\r\n        }\r\n      } else {\r\n        this.$message({\r\n          message: '无法修改超级管理员的权限',\r\n          duration: 2000,\r\n          type: 'info'\r\n        })\r\n        // this.getAuth(this.liActive)\r\n      }\r\n    },\r\n    // 取消\r\n    cancel (item, index) {\r\n      if (item !== '') {\r\n        item.isEdit = false\r\n        this.isEdit = false\r\n        this.$refs['roleForm'][index].resetFields()\r\n      } else {\r\n        this.isAdd = false\r\n        this.$refs['addRoleForm'].resetFields()\r\n      }\r\n    },\r\n    // 编辑\r\n    edit (item, index) {\r\n      if (this.isAdd) {\r\n        this.$message.error('有角色信息未保存')\r\n      } else {\r\n        item.isEdit = true\r\n        this.isEdit = true\r\n        let data = this.roleData\r\n        for (let i = 0; i < data.length; i++) {\r\n          if (data[i].id !== item.id) {\r\n            data[i].isEdit = false\r\n          }\r\n        }\r\n        this.roleForm.roleName = item.name\r\n        this.liActive = item\r\n        this.oldRoleName = item.name\r\n        this.roleClick(item)\r\n      }\r\n    },\r\n    // 删除\r\n    remove (item) {\r\n      confirm(`您确定删除角色' ${item.name} '吗？`, '提示').then(() => {\r\n        let checkIds = []\r\n        checkIds.push(item.id)\r\n        this.$fly.post(api.roleDelete, checkIds).then(data => {\r\n          if (data.status === 100000) {\r\n            this.$message({\r\n              showClose: true,\r\n              type: 'success',\r\n              message: '删除成功'\r\n            })\r\n            this.$refs.tree.setCheckedKeys([])\r\n            if (item.name === Cookies.getJSON('user').rolesName) {\r\n              this.signOut('您删除了当前用户所属的角色，请重新登录')\r\n            } else {\r\n              this.getRoles()\r\n            }\r\n          } else {\r\n            this.$message({\r\n              showClose: true,\r\n              type: 'error',\r\n              message: '删除失败'\r\n            })\r\n          }\r\n        }).catch(() => {\r\n          this.$message({\r\n            message: '请求失败',\r\n            duration: 2000,\r\n            type: 'error'\r\n          })\r\n        })\r\n      })\r\n    },\r\n    // 退出登录\r\n    signOut (txt) {\r\n      this.$message({\r\n        message: `${txt}`,\r\n        type: 'warning'\r\n      })\r\n      setTimeout(() => {\r\n        Cookies.remove('user')\r\n        this.$router.replace({\r\n          name: 'login'\r\n        })\r\n      }, 500)\r\n    },\r\n    // 角色点击事件\r\n    roleClick (item) {\r\n      if (!item.isActive) {\r\n        let data = this.roleData\r\n        for (let i = 0; i < data.length; i++) {\r\n          if (data[i].id !== item.id) {\r\n            data[i].isActive = false\r\n          } else {\r\n            item.isActive = true\r\n            this.liActive = item\r\n          }\r\n        }\r\n        this.liActiveId = item.id\r\n        this.$refs.tree.setCheckedKeys([])\r\n        this.getAuth(item)\r\n      }\r\n    },\r\n    // 获取角色的权限\r\n    getAuth (item) {\r\n      this.loading = true\r\n      let authority = []\r\n      this.$fly.get(api.roleGetOne, { id: item.id }).then(data => {\r\n        setTimeout(() => {\r\n          this.loading = false\r\n        }, 1000)\r\n        let checkedData = []\r\n        let checkedNameData = []\r\n        let roleData = data.data.authorities\r\n        roleData.map(item => {\r\n          authority.push(item.name)\r\n        })\r\n        authority.map(item => {\r\n          if (this.hasAuth(item)) {\r\n            this.data[0].subNav.map(dItem => {\r\n              dItem.subNav.map(sItem => {\r\n                if (!sItem.subNav) {\r\n                  if (item === sItem.auth()) {\r\n                    checkedData.push(sItem.id)\r\n                    checkedNameData.push({ name: sItem.auth() })\r\n                  }\r\n                } else {\r\n                  sItem.subNav.map(tItem => {\r\n                    if (item === tItem.auth) {\r\n                      checkedData.push(tItem.id)\r\n                      checkedNameData.push({ name: tItem.auth })\r\n                    }\r\n                  })\r\n                }\r\n              })\r\n            })\r\n          }\r\n        })\r\n        this.$set(this, 'checkedKeys', checkedData)\r\n        this.checkedNames = checkedNameData\r\n        // console.log(checkedNameData)\r\n        // console.log(this.checkedKeys)\r\n      }).catch(() => {\r\n        this.$message({\r\n          message: '删除失败',\r\n          duration: 2000,\r\n          type: 'error'\r\n        })\r\n      })\r\n    },\r\n    // 获取角色\r\n    getRoles () {\r\n      this.$fly.get(api.getRoles).then(data => {\r\n        data.data.RoleList.map(item => {\r\n          item.isEdit = false\r\n          item.isActive = false\r\n        })\r\n        this.roleData = data.data.RoleList\r\n      }).catch(() => {\r\n        this.$message({\r\n          message: '请求失败',\r\n          duration: 2000,\r\n          type: 'error'\r\n        })\r\n      })\r\n    }\r\n  },\r\n  created () {\r\n    this.getRoles()\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.page {\r\n  padding: 53px 0 0;\r\n  margin: 0 -20px;\r\n  height: 100%;\r\n  .tools-bar {\r\n    justify-content: flex-end;\r\n  }\r\n  .body {\r\n    display: flex;\r\n    height: 100%;\r\n    .left-wrap {\r\n      width: 300px;\r\n      position: relative;\r\n      height: 100%;\r\n      padding: 10px 0;\r\n      &::after {\r\n        content: \"\";\r\n        position: absolute;\r\n        top: 0px;\r\n        right: 0px;\r\n        bottom: 0px;\r\n        width: 1px;\r\n        background-color: $gray;\r\n        height: 100%;\r\n      }\r\n      .role {\r\n        width: 100%;\r\n        > li {\r\n          flex: 1;\r\n          > div {\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: space-between;\r\n            font-size: $font-size-14;\r\n            padding: 0 15px;\r\n            // border: 1px solid red;\r\n            > label:hover {\r\n              cursor: pointer;\r\n            }\r\n          }\r\n          &:hover {\r\n            background-color: $stable-f5;\r\n            cursor: pointer;\r\n          }\r\n          &.liActive {\r\n            background-color: $stable-f5;\r\n          }\r\n        }\r\n      }\r\n      .add-role {\r\n        padding: 0 15px;\r\n        .el-form-item__content {\r\n          display: flex;\r\n          justify-content: space-between;\r\n          .el-input {\r\n            width: calc(100% - 81px);\r\n          }\r\n          .el-button {\r\n            height: 30px;\r\n            margin-left: 10px;\r\n          }\r\n          .role-name {\r\n            /deep/ .el-input__inner {\r\n              height: 30px;\r\n              border: none;\r\n              border-radius: 0;\r\n              border-bottom: 1px solid $stable-dc;\r\n              padding: 0;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    .right-wrap {\r\n      flex: 1;\r\n      padding: 10px 0;\r\n      margin-left: 5px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/pages/system/authority.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"page\"},[_c('div',{staticClass:\"tools-bar btn-wrap\"},[_c('el-button',{attrs:{\"type\":\"primary\",\"size\":\"small\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.append($event)}}},[_vm._v(\"新增\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"warning\",\"size\":\"small\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.saveAll($event)}}},[_vm._v(\"保存\")])],1),_vm._v(\" \"),_c('div',{staticClass:\"body\"},[_c('div',{staticClass:\"left-wrap\"},[_c('ul',{staticClass:\"role\"},_vm._l((_vm.roleData),function(item,index){return _c('li',{key:index,class:{'liActive':item.isActive}},[_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(!item.isEdit),expression:\"!item.isEdit\"}],on:{\"click\":function($event){$event.stopPropagation();$event.preventDefault();_vm.roleClick(item)}}},[_c('label',[_vm._v(_vm._s(item.name))]),_vm._v(\" \"),(item.name!=='管理员')?_c('label',[_c('el-button',{attrs:{\"type\":\"text\",\"size\":\"mini\",\"icon\":\"el-icon-edit\"},on:{\"click\":function($event){$event.stopPropagation();$event.preventDefault();_vm.edit(item,index)}}},[_vm._v(\"\\n                编辑\\n              \")]),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"text\",\"size\":\"mini\",\"icon\":\"el-icon-delete\"},on:{\"click\":function($event){$event.stopPropagation();$event.preventDefault();_vm.remove(item)}}},[_vm._v(\"\\n                删除\\n              \")])],1):_vm._e()]),_vm._v(\" \"),_c('el-form',{directives:[{name:\"show\",rawName:\"v-show\",value:(item.isEdit),expression:\"item.isEdit\"}],ref:\"roleForm\",refInFor:true,staticClass:\"add-role\",attrs:{\"model\":_vm.roleForm,\"rules\":_vm.roleRules}},[_c('el-form-item',{attrs:{\"prop\":\"roleName\"}},[_c('el-input',{ref:\"editRoleName\",refInFor:true,staticClass:\"role-name\",attrs:{\"placeholder\":\"请输入角色名\",\"autofocus\":\"\"},model:{value:(_vm.roleForm.roleName),callback:function ($$v) {_vm.$set(_vm.roleForm, \"roleName\", $$v)},expression:\"roleForm.roleName\"}}),_vm._v(\" \"),_c('label',{staticClass:\"btn-wrap\"},[_c('el-button',{attrs:{\"type\":\"text\",\"size\":\"mini\"},on:{\"click\":function($event){$event.stopPropagation();$event.preventDefault();_vm.save(item,index)}}},[_vm._v(\"保存\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"text\",\"size\":\"mini\"},on:{\"click\":function($event){$event.stopPropagation();$event.preventDefault();_vm.cancel(item,index)}}},[_vm._v(\"取消\")])],1)],1)],1)],1)})),_vm._v(\" \"),(_vm.isAdd)?_c('el-form',{ref:\"addRoleForm\",staticClass:\"add-role\",attrs:{\"model\":_vm.roleForm,\"rules\":_vm.roleRules}},[_c('el-form-item',{attrs:{\"prop\":\"roleName\"}},[_c('el-input',{ref:\"roleName\",staticClass:\"role-name\",attrs:{\"placeholder\":\"请输入角色名\",\"autofocus\":\"\"},model:{value:(_vm.roleForm.roleName),callback:function ($$v) {_vm.$set(_vm.roleForm, \"roleName\", $$v)},expression:\"roleForm.roleName\"}}),_vm._v(\" \"),_c('label',{staticClass:\"btn-wrap\"},[_c('el-button',{attrs:{\"type\":\"text\",\"size\":\"mini\"},on:{\"click\":function($event){$event.stopPropagation();_vm.save('')}}},[_vm._v(\"保存\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"text\",\"size\":\"mini\"},on:{\"click\":function($event){$event.stopPropagation();_vm.cancel('')}}},[_vm._v(\"取消\")])],1)],1)],1):_vm._e()],1),_vm._v(\" \"),_c('div',{staticClass:\"right-wrap\"},[_c('el-tree',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}],ref:\"tree\",attrs:{\"data\":_vm.data,\"show-checkbox\":\"\",\"default-expand-all\":\"\",\"default-checked-keys\":_vm.checkedKeys,\"node-key\":\"id\",\"props\":_vm.defaultProps},on:{\"check\":_vm.checked}})],1)])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-b5c96c60\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/system/authority.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-b5c96c60\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"sourceMap\\\":true}!sass-resources-loader?{\\\"resources\\\":\\\"D:\\\\\\\\work\\\\\\\\junyang_admin\\\\\\\\src\\\\\\\\assets\\\\\\\\sass\\\\\\\\var.scss\\\"}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./authority.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./authority.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./authority.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-b5c96c60\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./authority.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-b5c96c60\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/system/authority.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}