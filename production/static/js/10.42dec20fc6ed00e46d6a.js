webpackJsonp([10],{"33/D":function(e,t){},JSff:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("0xDb"),r=s("bGai"),o=s("lbHh"),n=s.n(o),l={data:function(){var e=this;return{params:{page:1},checkData:[],pageInfo:{totalElements:0,currentPage:1},tableData:[],loading:!1,dialogResetPassword:!1,form:{oldPassword:null,newPassword:null,surePassword:""},rules:{oldPassword:[{required:!0,validator:function(t,s,r){s?e.$fly.post(a.a.existPassword,{id:e.userId,oldPassword:s}).then(function(t){1e5===t.status?t.data?r():r(new Error("旧密码错误")):e.$message({message:"请求错误",type:"error"})}):r(new Error("请输入旧密码"))},trigger:"blur"}],newPassword:[{required:!0,validator:function(t,s,a){s?/^[0-9a-zA_Z]+$/.test(s)?e.form.oldPassword===s?a(new Error("两次密码不能一致")):a():a(new Error("密码只能是英文字母或数字")):a(new Error("请输入新密码"))},trigger:"blur"}],surePassword:[{required:!0,validator:function(t,s,a){s?s!==e.form.newPassword?a(new Error("密码不一致")):a():a(new Error("请输入确认密码"))},trigger:"blur"}]},userId:"",username:"",isDeleteShelf:!1}},components:{listHandle:r.c,pagination:r.d},methods:{handleDelete:function(){var e=this;this.checkIds=[],Object(a.b)("您确定将选择的用户禁用吗？","提示").then(function(){for(var t=0;t<e.checkData.length;t++){if("DISABLED"===e.checkData[t].status)return e.$message.error("已禁用的用户不能禁用"),void(e.checkIds=[]);e.checkIds.push(e.checkData[t].id)}e.checkIds.length>0&&e.$fly.post(a.a["system/userDelete"],{ids:e.checkIds,status:"disabled"}).then(function(t){if(1e5!==t.status)return e.$message({message:"禁用失败",duration:2e3,type:"error"});e.$message({message:"禁用成功",duration:2e3,type:"success"}),e.refresh()}).catch(function(){e.$message({message:"禁用失败",duration:2e3,type:"error"})})})},filterTag:function(e,t){return t.status===e},resetPassword:function(e){var t=this;console.log(e),this.userId=e.id,this.username=e.username,this.dialogResetPassword=!0,this.$nextTick(function(){t.$refs.form.resetFields()})},cancel:function(){this.$refs.form.resetFields(),this.dialogResetPassword=!1},save:function(){var e=this;this.$refs.form.validate(function(t){if(t){var s=e.form,r=s.oldPassword,o=s.newPassword;e.$fly.post(a.a.resetPassword,{id:e.userId,oldPassword:r,newPassword:o}).then(function(t){1e5===t.status?(e.$refs.form.resetFields(),e.dialogResetPassword=!1,e.$message({message:"重置密码成功",type:"success"}),e.username===n.a.getJSON("user").userName&&e.signOut("您重置了当前用户的密码，请重新登录")):e.$message({message:"重置密码失败",type:"error"})})}})},refresh:function(){this.params.page=1,this.isDeleteShelf?this.signOut("您删除了当前用户，请重新登录"):this.getData(this.params)},handleSelectionChange:function(e){var t=this;this.checkData=[],this.lodash.map(e,function(e){t.checkData.push({id:e.id,status:e.status}),e.username===n.a.getJSON("user").userName&&(t.isDeleteShelf=!0)})},signOut:function(e){var t=this;this.$message({message:""+e,type:"warning"}),setTimeout(function(){n.a.remove("user"),t.$router.replace({name:"login"})},500)},pagination:function(e){this.params.page=e.page,this.params.size=e.limit,this.getData(this.params)},getData:function(e){var t=this;e.page--,this.loading=!0,this.$fly.get(a.a.getUsers,e).then(function(s){setTimeout(function(){t.loading=!1},1e3);var a=s.data,r=a.content,o=a.totalElements;t.tableData=r,t.pageInfo={totalElements:parseInt(o),currentPage:e.page+1}})}},created:function(){this.getData(this.params)},mounted:function(){this.params.size=this.$refs.pageInfo.pageSizes[0]}},i={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"page"},[s("div",{staticClass:"tools-bar"},[s("listHandle",{attrs:{showSoldout:!1,checkData:e.checkData,showDelete:!1},on:{refresh:e.refresh}},[s("el-button",{attrs:{type:"danger",size:"small"},on:{click:e.handleDelete}},[e._v("禁用")])],1)],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",attrs:{"header-cell-class-name":"tableHeader",data:e.tableData,"element-loading-text":"拼命加载中",border:"",stripe:""},on:{"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"55",align:"center","label-class-name":"checkLabel"}}),e._v(" "),s("el-table-column",{attrs:{type:"index",width:"50",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"nickname",label:"昵称",align:"center","min-width":"150","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{prop:"username",label:"账号",align:"center","min-width":"150","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{prop:"phoneNumber",label:"手机号",align:"center",width:"150"}}),e._v(" "),s("el-table-column",{attrs:{prop:"department",label:"部门",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.department?[e._v(e._s(t.row.department.name))]:void 0}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"status",label:"状态",width:"100",align:"center",filters:[{text:"禁用",value:"DISABLED"},{text:"可用",value:"ENABLED"}],"filter-method":e.filterTag,"filter-placement":"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",{attrs:{type:"DISABLED"===t.row.status?"danger":"success","disable-transitions":""}},[e._v("\n          "+e._s("DISABLED"===t.row.status?"禁用":"可用")+"\n        ")])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"角色",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return 1===t.row.roles.length?[e._v(e._s(t.row.roles[0].name))]:void 0}}])}),e._v(" "),s("el-table-column",{attrs:{label:"创建时间",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("dateTime")(t.row.createTime,"yyyy-MM-dd hh:mm:ss")))]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"remark",label:"备注","min-width":"200","show-overflow-tooltip":"",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text ",size:"mini"}},[s("router-link",{attrs:{to:{name:"system/user",params:{type:"edit"},query:{id:t.row.id}},tag:"span"}},[e._v("编辑")])],1),e._v(" "),s("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(s){s.stopPropagation(),e.resetPassword(t.row)}}},[e._v("重置密码")])]}}])})],1),e._v(" "),s("pagination",{ref:"pageInfo",attrs:{total:e.pageInfo.totalElements,page:e.pageInfo.currentPage},on:{"update:page":function(t){e.$set(e.pageInfo,"currentPage",t)},pagination:e.pagination}}),e._v(" "),s("el-dialog",{attrs:{title:"重置密码",visible:e.dialogResetPassword,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogResetPassword=t}}},[s("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px","label-suffix":":"}},[s("el-form-item",{attrs:{label:"旧密码",prop:"oldPassword"}},[s("el-input",{attrs:{type:"password"},model:{value:e.form.oldPassword,callback:function(t){e.$set(e.form,"oldPassword",t)},expression:"form.oldPassword"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"新密码",prop:"newPassword"}},[s("el-input",{attrs:{type:"password"},model:{value:e.form.newPassword,callback:function(t){e.$set(e.form,"newPassword",t)},expression:"form.newPassword"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"确认密码",prop:"surePassword"}},[s("el-input",{attrs:{type:"password"},model:{value:e.form.surePassword,callback:function(t){e.$set(e.form,"surePassword",t)},expression:"form.surePassword"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){return t.stopPropagation(),e.cancel(t)}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){return t.stopPropagation(),e.save(t)}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var d=s("VU/8")(l,i,!1,function(e){s("33/D")},"data-v-39a9be60",null);t.default=d.exports}});
//# sourceMappingURL=10.42dec20fc6ed00e46d6a.js.map