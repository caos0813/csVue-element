webpackJsonp([16],{LWQV:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=t("0xDb"),s=t("5aCZ"),r={data:function(){return{params:{title:"",image:"",isArticle:!0,pickerVal:[],content:"",status:""},firstData:[],secondData:[],threeData:[],rules:{title:[{required:!0,message:"标题不能为空，且最多输入20个字符",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}],image:[{type:"string",required:!0,message:"请上传封面",trigger:"blur"}],pickerVal:[{required:!0,validator:function(e,a,t){a.length<3?t(new Error("请选择模块、专题和文章")):t()},trigger:"change"}]},timeDialog:!1,addForm:{publishTime:""},pickerOptions2:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},formRules:{publishTime:[{type:"date",required:!0,message:"时间不能为空",trigger:"change"}]}}},components:{upload:t("bGai").f,Tinymce:s.a},watch:{pickerVal:function(){}},methods:{release:function(){this.params.status=1,this.postData("form",i.a.zhiyuan_bannerPublishNow)},timeRelease:function(){var e=this;this.$refs.form.validate(function(a){a&&(e.timeDialog=!0,e.$refs.addForm&&e.$refs.addForm.resetFields())})},submit:function(){this.params.status=2,this.postData("form",i.a.zhiyuan_bannerSave)},postData:function(e,a){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;var i=t.params,s=i.title,r=i.image,l=i.isArticle,n=i.id,o=i.content,c=i.pickerVal,p=i.status,m=t.timeDialog?new Date(t.addForm.publishTime).getTime():null,u=void 0;u="edit"===t.$route.params.type?t.params.moduleId:t.$route.query.moduleId,console.log(c),t.$fly.post(a,{moduleId:u,id:n,title:s,identification:l?2:1,releaseTime:m,picture:r,content:l?null:o,articleInfoId:l?c[2]:null,status:p}).then(function(e){t.$message({message:"保存成功",duration:2e3,type:"success"}),t.$refs.form.resetFields(),t.timeDialog=!1,t.goBack()}).catch(function(){t.$message({message:"保存失败",duration:2e3,type:"error"})})})},save:function(){this.params.status=4,this.postData("addForm",i.a.zhiyuan_bannerPublishDelay)},cancel:function(){this.$refs.addForm.resetFields(),this.timeDialog=!1},selectChange:function(e){this.isLink=e,e?this.params.content="":this.params.url=""},firstChange:function(e,a){a||(this.params.pickerVal[1]=null,this.params.pickerVal[2]=null);var t=this.lodash.findIndex(this.firstData,function(a){return a.id===e});this.secondData=this.firstData[t].specialTopicInfoConditionBeans},secondChange:function(e){var a=this.lodash.findIndex(this.secondData,function(a){return a.id===e});this.threeData=this.secondData[a].atricleSelectBeanList},getQueryCondition:function(){var e=this;this.$fly.get(i.a.bannerQueryCondition,{productId:3}).then(function(a){1e5===a.status?(e.firstData=a.data,e.params.pickerVal.length&&(e.lodash.isUndefined(e.params.pickerVal[0])||(e.firstChange(e.params.pickerVal[0],!0),e.lodash.isUndefined(e.params.pickerVal[1])||e.secondChange(e.params.pickerVal[1])))):e.$message({message:"请求失败",duration:2e3,type:"error"})}).catch(function(){e.$message({message:"请求失败",duration:2e3,type:"error"})})}},created:function(){var e=this,a=this.$route.params.type,t=this.$route.query.id;"edit"===a?this.$fly.get(i.a.zhiyuan_bannerDetail,{id:t}).then(function(a){if(1e5===a.status){var t=a.data,i=t.id,s=t.articleInfoId,r=t.content,l=t.title,n=t.identification,o=t.picture,c=t.moduleId,p=t.specialTopicInfoId,m=t.moduleConditionId;e.params.id=i,e.params.title=l,e.params.content=r,e.params.moduleId=c,e.params.isArticle=1!==n,e.params.image=o,2===n?(e.params.pickerVal[0]=m,e.params.pickerVal[1]=p,e.params.pickerVal[2]=s):e.params.pickerVal=[],e.getQueryCondition()}else e.$message({message:"请求失败",duration:2e3,type:"error"})}).catch(function(){e.$message({message:"请求失败",duration:2e3,type:"error"})}):this.getQueryCondition()}},l=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"page"},[t("div",{staticClass:"tools-bar"},[t("div",{staticClass:"left-wrap"},[t("back")],1),e._v(" "),t("div",{staticClass:"button-wrap"},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.release}},[e._v("直接发布")]),e._v(" "),t("el-button",{attrs:{type:"info",size:"small"},on:{click:e.timeRelease}},[e._v("定时发布")]),e._v(" "),t("el-button",{attrs:{type:"warning",size:"small"},on:{click:e.submit}},[e._v("草稿")])],1)]),e._v(" "),t("el-form",{ref:"form",attrs:{model:e.params,rules:e.rules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"标题",prop:"title"}},[t("el-col",{attrs:{span:12}},[t("el-input",{attrs:{placeholder:"请输入标题",maxlength:"20"},model:{value:e.params.title,callback:function(a){e.$set(e.params,"title",a)},expression:"params.title"}})],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"封面",prop:"image"}},[t("upload",{attrs:{path:"image/article/"},model:{value:e.params.image,callback:function(a){e.$set(e.params,"image",a)},expression:"params.image"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"选择文章"}},[t("el-switch",{on:{change:e.selectChange},model:{value:e.params.isArticle,callback:function(a){e.$set(e.params,"isArticle",a)},expression:"params.isArticle"}})],1),e._v(" "),e.params.isArticle?t("el-form-item",{attrs:{label:"选择文章",prop:e.params.isArticle?"pickerVal":""}},[t("el-select",{staticClass:"mRight_15",attrs:{placeholder:"请选择模块"},on:{change:e.firstChange},model:{value:e.params.pickerVal[0],callback:function(a){e.$set(e.params.pickerVal,0,a)},expression:"params.pickerVal[0]"}},e._l(e.firstData,function(e,a){return t("el-option",{key:a,attrs:{label:e.name,value:e.id}})})),e._v(" "),t("el-select",{staticClass:"mRight_15",attrs:{placeholder:"请选择专题"},on:{change:e.secondChange},model:{value:e.params.pickerVal[1],callback:function(a){e.$set(e.params.pickerVal,1,a)},expression:"params.pickerVal[1]"}},e._l(e.secondData,function(e,a){return t("el-option",{key:a,attrs:{label:e.title,value:e.id}})})),e._v(" "),t("el-select",{attrs:{placeholder:"请选择文章"},model:{value:e.params.pickerVal[2],callback:function(a){e.$set(e.params.pickerVal,2,a)},expression:"params.pickerVal[2]"}},e._l(e.threeData,function(e,a){return t("el-option",{key:a,attrs:{label:e.title,value:e.id}})}))],1):t("el-form-item",{attrs:{prop:e.params.isArticle?"":"content"}},[t("el-col",{attrs:{span:18}},[t("Tinymce",{ref:"editor",attrs:{height:600},model:{value:e.params.content,callback:function(a){e.$set(e.params,"content",a)},expression:"params.content"}})],1)],1)],1),e._v(" "),t("el-dialog",{attrs:{title:"定时发布",visible:e.timeDialog,width:"500px","close-on-click-modal":!1},on:{"update:visible":function(a){e.timeDialog=a}}},[t("el-form",{ref:"addForm",attrs:{model:e.addForm,"inline-message":"",rules:e.formRules,"label-suffix":":","label-width":"100"}},[t("el-form-item",{attrs:{label:"发布时间",prop:"publishTime"}},[t("el-col",{attrs:{span:12}},[t("el-date-picker",{staticClass:"full",attrs:{type:"datetime","picker-options":e.pickerOptions2,placeholder:"请选择发布时间"},model:{value:e.addForm.publishTime,callback:function(a){e.$set(e.addForm,"publishTime",a)},expression:"addForm.publishTime"}})],1)],1)],1),e._v(" "),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancel}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确定")])],1)],1)],1)};l._withStripped=!0;var n={render:l,staticRenderFns:[]},o=n;var c=t("VU/8")(r,o,!1,null,null,null);c.options.__file="src/pages/zhiyuan/banner/add.vue";a.default=c.exports}});
//# sourceMappingURL=16.1279b98eb173eb7df23f.js.map