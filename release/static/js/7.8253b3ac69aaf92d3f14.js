webpackJsonp([7],{"32kj":function(e,a,t){var i=t("siJn");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);t("rjj0")("988b7bbc",i,!1,{})},L0Lu:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=t("5aCZ"),s=t("0xDb"),l=t("bGai"),r={data:function(){return{rules:{title:[{required:!0,message:"请输入专题名称",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}],image:[{type:"string",required:!0,message:"请上传封面",trigger:"blur"}],audioPath:[{required:!0,message:"请上传音频",trigger:"blur"}],pickerVal:[{required:!0,validator:function(e,a,t){a.length<2?t(new Error("请选择产品分类和专题")):t()},trigger:"change"}]},params:{title:"",isHomePageShow:0,audioFlag:0,pickerVal:[],image:""},isAudioFlag:!1,timeDialog:!1,addForm:{publishTime:""},pickerOptions2:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},formRules:{publishTime:[{type:"date",required:!0,message:"时间不能为空",trigger:"change"}]}}},components:{upload:l.e,Tinymce:i.a,picker:l.d},methods:{release:function(){this.postData("form",s.a.articlePublishNow,1)},timeRelease:function(){var e=this;this.$refs.form.validate(function(a){a&&(e.timeDialog=!0,e.$refs.addForm&&e.$refs.addForm.resetFields())})},save:function(){this.postData("addForm",s.a.articlePublishDelay,4)},cancel:function(){this.$refs.addForm.resetFields(),this.timeDialog=!1},submit:function(){this.postData("form",s.a.articleHandle,2)},postData:function(e,a,t){var i=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;var s=i.params,l=s.title,r=s.isHomePageShow,o=s.image,n=s.pickerVal,p=s.id,c=s.content,m=s.audioPath,u=s.audioFlag,d=s.textarea;console.log(i.params);var g=i.timeDialog?new Date(i.addForm.publishTime).getTime():null;i.$fly.post(a,{id:p,title:l,audioPath:u?m:null,isHomePageShow:r,publishTime:g,image:u?null:o,content:u?d:c,specialTopicId:n[1],productId:n[0],status:t}).then(function(e){console.log(e),i.$message({message:"保存成功",duration:2e3,type:"success"}),i.$refs.form.resetFields(),i.timeDialog=!1,i.goBack()}).catch(function(){i.$message({message:"保存失败",duration:2e3,type:"error"})})})}},created:function(){var e=this,a=this.$route.params.type,t=this.$route.query.id;"edit"===a&&this.$fly.get(s.a.articleDetail,{id:t}).then(function(a){e.params=a,console.log(e.lodash.isNull(a.audioPath)),e.lodash.isNull(a.audioPath)?(e.params.audioFlag=0,e.isAudioFlag=!0):(e.params.audioFlag=1,e.isAudioFlag=!0,e.params.textarea=a.content),e.params.pickerVal=[a.product.id,a.specialTopic.id]})}},o=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"page"},[t("div",{staticClass:"tools-bar"},[t("div",{staticClass:"left-wrap"},[t("back")],1),e._v(" "),t("div",{staticClass:"button-wrap"},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.release}},[e._v("直接发布")]),e._v(" "),t("el-button",{attrs:{type:"info",size:"small"},on:{click:e.timeRelease}},[e._v("定时发布")]),e._v(" "),t("el-button",{attrs:{type:"warning",size:"small"},on:{click:e.submit}},[e._v("草稿")])],1)]),e._v(" "),t("el-form",{ref:"form",attrs:{model:e.params,rules:e.rules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"专题",prop:"pickerVal"}},[t("picker",{attrs:{column:2},model:{value:e.params.pickerVal,callback:function(a){e.$set(e.params,"pickerVal",a)},expression:"params.pickerVal"}}),e._v(" "),t("el-col",{attrs:{span:4}},[t("el-form-item",{attrs:{"label-width":"20px"}},[[t("el-checkbox",{attrs:{"true-label":1,"false-label":0,disabled:e.isAudioFlag},model:{value:e.params.audioFlag,callback:function(a){e.$set(e.params,"audioFlag",a)},expression:"params.audioFlag"}},[e._v("音频")])]],2)],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"标题",prop:"title"}},[t("el-col",{attrs:{span:12}},[t("el-input",{model:{value:e.params.title,callback:function(a){e.$set(e.params,"title",a)},expression:"params.title"}})],1),e._v(" "),t("el-col",{attrs:{span:4}},[t("el-form-item",{attrs:{"label-width":"20px"}},[[t("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.params.isHomePageShow,callback:function(a){e.$set(e.params,"isHomePageShow",a)},expression:"params.isHomePageShow"}},[e._v("首页显示")])]],2)],1)],1),e._v(" "),1===e.params.audioFlag?t("div",[t("el-form-item",{attrs:{label:"音频",prop:"audioPath"}},[t("upload",{attrs:{type:"audio",accept:"audio/*",path:"audio/article/"},model:{value:e.params.audioPath,callback:function(a){e.$set(e.params,"audioPath",a)},expression:"params.audioPath"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"音频描述",prop:"textarea"}},[t("el-col",{attrs:{span:12}},[t("el-input",{attrs:{placeholder:"请输入音频描述",type:"textarea",rows:6},model:{value:e.params.textarea,callback:function(a){e.$set(e.params,"textarea",a)},expression:"params.textarea"}})],1)],1)],1):e._e(),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:1!==e.params.audioFlag,expression:"params.audioFlag!==1"}]},[t("el-form-item",{attrs:{label:"封面",prop:e.params.audioFlag?"":"image"}},[t("upload",{attrs:{path:"image/article/"},model:{value:e.params.image,callback:function(a){e.$set(e.params,"image",a)},expression:"params.image"}})],1),e._v(" "),t("el-form-item",{attrs:{prop:e.params.audioFlag?"":"content"}},[t("el-col",{attrs:{span:18}},[t("Tinymce",{ref:"editor",attrs:{height:600},model:{value:e.params.content,callback:function(a){e.$set(e.params,"content",a)},expression:"params.content"}})],1)],1)],1)],1),e._v(" "),t("el-dialog",{attrs:{title:"定时发布",visible:e.timeDialog,width:"500px","close-on-click-modal":!1},on:{"update:visible":function(a){e.timeDialog=a}}},[t("el-form",{ref:"addForm",attrs:{model:e.addForm,"inline-message":"",rules:e.formRules,"label-suffix":":","label-width":"100"}},[t("el-form-item",{attrs:{label:"发布时间",prop:"publishTime"}},[t("el-col",{attrs:{span:12}},[t("el-date-picker",{staticClass:"full",attrs:{type:"datetime","picker-options":e.pickerOptions2,placeholder:"请选择发布时间"},model:{value:e.addForm.publishTime,callback:function(a){e.$set(e.addForm,"publishTime",a)},expression:"addForm.publishTime"}})],1)],1)],1),e._v(" "),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancel}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确定")])],1)],1)],1)};o._withStripped=!0;var n={render:o,staticRenderFns:[]},p=n;var c=!1;var m=t("VU/8")(r,p,!1,function(e){c||t("32kj")},"data-v-24ce6648",null);m.options.__file="src\\pages\\article.vue";a.default=m.exports},siJn:function(e,a,t){(e.exports=t("FZ+f")(!0)).push([e.i,"","",{version:3,sources:[],names:[],mappings:"",file:"article.vue",sourceRoot:""}])}});