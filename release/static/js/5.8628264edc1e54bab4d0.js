webpackJsonp([5],{"9qU9":function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=t("5aCZ"),o=t("0xDb"),i=t("bGai"),s={data:function(){var n=this;return{rules:{title:[{required:!0,message:"请输入专题名称",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}],pickerVal:[{required:!0,validator:function(n,e,t){e.length<1?t(new Error("请选择产品分类和专题")):t()},trigger:"change"}],vote:[{required:!0,validator:function(e,t,a){console.log(t),n.optionData.length<1?a(new Error("请添加选项")):a()},trigger:"change"}]},params:{title:"",isHot:0,type:0,pickerVal:[]},optionData:[],mode:"general",timeDialog:!1,addForm:{publishTime:""},pickerOptions2:{disabledDate:function(n){return n.getTime()<Date.now()-864e5}},formRules:{publishTime:[{type:"date",required:!0,message:"时间不能为空",trigger:"change"}]}}},components:{Tinymce:a.a,picker:i.e},methods:{modeChange:function(n){"general"===n?this.params.type=0:this.params.type||(this.params.type=1)},release:function(){this.postData("form",o.a.gambitPublishNow,1)},timeRelease:function(){var n=this;this.$refs.form.validate(function(e){if(!e)return console.log("error submit!!"),!1;n.timeDialog=!0,n.$refs.addForm&&n.$refs.addForm.resetFields()})},save:function(){this.postData("addForm",o.a.gambitPublishDelay,4)},cancel:function(){this.$refs.addForm.resetFields(),this.timeDialog=!1},submit:function(){this.postData("form",o.a.topicHandle,2)},postData:function(n,e,t){var a=this;this.$refs[n].validate(function(n){if(!n)return console.log("error submit!!"),!1;var o=a.params,i=o.title,s=o.isHot,r=o.pickerVal,l=o.type,c=o.id,p=o.content,d="vote"===a.mode?a.optionData:null,u=a.timeDialog?new Date(a.addForm.publishTime).getTime():null;a.lodash.isArray(d)&&d.length<1?a.$message({message:"请添加选项",duration:2e3,type:"error"}):(console.log(i,s,r,l,c,p,u),a.$fly.post(e,{id:c,title:i,isHot:s,publishTime:u,content:p,type:l,votes:d,productId:r[0],status:t}).then(function(n){a.$message({message:"保存成功",duration:2e3,type:"success"}),a.$refs.form.resetFields(),a.timeDialog=!1,a.goBack()}).catch(function(){a.$message({message:"保存失败",duration:2e3,type:"error"})}))})},addRow:function(){this.optionData.push({voteContent:""})},delRow:function(n){var e=this;console.log(n);var t=n.$index;"edit"===this.$route.params.type?this.$fly.post(o.a.topicDeleteVote,{id:n.row.id}).then(function(n){e.optionData.splice(t,1)}).catch(function(){e.$message({message:"删除失败",duration:2e3,type:"error"})}):this.optionData.splice(t,1)},moveRow:function(n,e){var t=n.$index,a=this.optionData[t];"up"===e?(this.optionData.splice(t,1),this.optionData.splice(t-1,0,a)):(this.optionData.splice(t,1),this.optionData.splice(t+1,0,a))}},created:function(){var n=this,e=this.$route.params.type,t=this.$route.query.id;"edit"===e&&this.$fly.get(o.a.topicDetail,{id:t}).then(function(e){n.params=e,n.optionData=e.votes,n.params.pickerVal=[e.product.id],1!==e.type&&2!==e.type||(n.mode="vote")})}},r=function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{staticClass:"page"},[t("div",{staticClass:"tools-bar"},[t("div",{staticClass:"left-wrap"},[t("back")],1),n._v(" "),t("div",{staticClass:"button-wrap"},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:n.release}},[n._v("直接发布")]),n._v(" "),t("el-button",{attrs:{type:"info",size:"small"},on:{click:n.timeRelease}},[n._v("定时发布")]),n._v(" "),t("el-button",{attrs:{type:"warning",size:"small"},on:{click:n.submit}},[n._v("草稿")])],1)]),n._v(" "),t("el-form",{ref:"form",attrs:{model:n.params,rules:n.rules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"产品",prop:"pickerVal"}},[t("picker",{model:{value:n.params.pickerVal,callback:function(e){n.$set(n.params,"pickerVal",e)},expression:"params.pickerVal"}})],1),n._v(" "),t("el-form-item",{attrs:{label:"类型"}},[t("el-col",{attrs:{span:6}},[t("el-select",{staticClass:"full",attrs:{placeholder:""},on:{change:n.modeChange},model:{value:n.mode,callback:function(e){n.mode=e},expression:"mode"}},[t("el-option",{attrs:{value:"general",label:"普通话题"}}),n._v(" "),t("el-option",{attrs:{value:"vote",label:"投票"}})],1)],1)],1),n._v(" "),t("el-form-item",{attrs:{label:"标题",prop:"title"}},[t("el-col",{attrs:{span:12}},[t("el-input",{model:{value:n.params.title,callback:function(e){n.$set(n.params,"title",e)},expression:"params.title"}})],1),n._v(" "),t("el-col",{attrs:{span:4}},[t("el-form-item",{attrs:{"label-width":"20px",prop:"isHot"}},[[t("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:n.params.isHot,callback:function(e){n.$set(n.params,"isHot",e)},expression:"params.isHot"}},[n._v("是否热门")])]],2)],1)],1),n._v(" "),"vote"===n.mode?t("el-form-item",{attrs:{prop:"vote"}},[t("el-form-item",[t("el-button",{attrs:{type:"info",size:"small"},on:{click:n.addRow}},[n._v("添加选项")]),n._v(" "),t("div",{staticClass:"radio-wrap"},[t("el-radio-group",{model:{value:n.params.type,callback:function(e){n.$set(n.params,"type",e)},expression:"params.type"}},[t("el-radio",{attrs:{label:1}},[n._v("单选")]),n._v(" "),t("el-radio",{attrs:{label:2}},[n._v("多选")])],1)],1)],1),n._v(" "),t("div",{staticClass:"space"}),n._v(" "),t("el-col",{attrs:{span:18}},[t("el-table",{attrs:{data:n.optionData,border:"","show-header":!1}},[t("el-table-column",{attrs:{label:"索引",align:"center",type:"index",width:"150px"}}),n._v(" "),t("el-table-column",{attrs:{label:"内容",align:"center"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("el-input",{attrs:{placeholder:""},model:{value:e.row.voteContent,callback:function(t){n.$set(e.row,"voteContent",t)},expression:"scope.row.voteContent"}})]}}])}),n._v(" "),t("el-table-column",{attrs:{label:"操作",align:"center",width:"200px"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("el-button",{attrs:{icon:"el-icon-arrow-up",circle:"",size:"small",title:"上移",disabled:0===e.$index},on:{click:function(t){n.moveRow(e,"up")}}}),n._v(" "),t("el-button",{attrs:{icon:"el-icon-arrow-down",circle:"",size:"small",title:"下移",disabled:e.$index==n.optionData.length-1},on:{click:function(t){n.moveRow(e,"down")}}}),n._v(" "),t("el-button",{attrs:{type:"danger",size:"small",icon:"el-icon-delete",circle:""},on:{click:function(t){n.delRow(e)}}})]}}])})],1)],1)],1):n._e(),n._v(" "),t("el-form-item",{attrs:{prop:"content"}},[t("el-col",{attrs:{span:18}},[t("Tinymce",{ref:"editor",attrs:{height:600},model:{value:n.params.content,callback:function(e){n.$set(n.params,"content",e)},expression:"params.content"}})],1)],1)],1),n._v(" "),t("el-dialog",{attrs:{title:"定时发布",visible:n.timeDialog,width:"500px","close-on-click-modal":!1},on:{"update:visible":function(e){n.timeDialog=e}}},[t("el-form",{ref:"addForm",attrs:{model:n.addForm,"inline-message":"",rules:n.formRules,"label-suffix":":","label-width":"100"}},[t("el-form-item",{attrs:{label:"发布时间",prop:"publishTime"}},[t("el-col",{attrs:{span:12}},[t("el-date-picker",{staticClass:"full",attrs:{"picker-options":n.pickerOptions2,type:"datetime",placeholder:"请选择发布时间"},model:{value:n.addForm.publishTime,callback:function(e){n.$set(n.addForm,"publishTime",e)},expression:"addForm.publishTime"}})],1)],1)],1),n._v(" "),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:n.cancel}},[n._v("取消")]),n._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:n.save}},[n._v("确定")])],1)],1)],1)};r._withStripped=!0;var l={render:r,staticRenderFns:[]},c=l;var p=!1;var d=t("VU/8")(s,c,!1,function(n){p||t("XDjy")},"data-v-47442bba",null);d.options.__file="src/pages/xuanke/topic/add.vue";e.default=d.exports},AxrR:function(n,e,t){(n.exports=t("FZ+f")(!0)).push([n.i,"\n.radio-wrap[data-v-47442bba] {\n  display: inline-block;\n  padding-left: 15px;\n}\n","",{version:3,sources:["D:/work/junyang_admin/src/pages/xuanke/topic/D:/work/junyang_admin/src/pages/xuanke/topic/add.vue"],names:[],mappings:";AAuSA;EACE,sBAAqB;EACrB,mBAAkB;CACnB",file:"add.vue",sourcesContent:["$light:#fff;\r\n$black:#000;\r\n$gray:#eee;\r\n$gray-ee:#eef1f6;\r\n$stable-dc:#dcdfe6;\r\n$stable-f5:#f5f7fa;\r\n$dark03:#303133 !default;\r\n$color-primary: #409EFF !default;\r\n\r\n$font-size-12:12px;\r\n$font-size-14:14px;\r\n$font-size-16:16px;\r\n$font-size-18:18px;\r\n$font-size-20:20px;\r\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.radio-wrap {\r\n  display: inline-block;\r\n  padding-left: 15px;\r\n}\r\n"],sourceRoot:""}])},XDjy:function(n,e,t){var a=t("AxrR");"string"==typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);t("rjj0")("c77cbee4",a,!1,{})}});
//# sourceMappingURL=5.8628264edc1e54bab4d0.js.map